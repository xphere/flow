#!/bin/bash
. boot

usage() {
    stderr "Change safely between branches, saving current state"
    stderr
    stderr "Usage:"
    stderr "  git change-to <branch-name>"
    stderr
}

main() {
    if [ -z "$1" ]; then
        usage
        exit 1
    fi

    BRANCH="$1"
    if ! git_has_branch "$BRANCH"; then
        die Branch "$BRANCH" does not exist
    fi

    if [ "$(git_current_branch)" != "$BRANCH" ]; then
        store
        git checkout "$BRANCH"
        recover
    fi
}

main "$@"
